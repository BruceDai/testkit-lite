#
# Copyright (C) 2012, Intel Corporation.
# 
# This program is free software; you can redistribute it and/or modify it
# under the terms and conditions of the GNU General Public License,
# version 2, as published by the Free Software Foundation.
#
# This program is distributed in the hope it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
# for more details.  
#
# You should have received a copy of the GNU General Public License along with
# this program; if not, write to the Free Software Foundation, Inc., 59 Temple
# Place - Suite 330, Boston, MA 02111-1307 USA.
#
# Authors:
#                   Tian, Xu <xux.tian@intel.com>
#                   Zhang, Huihui <huihuix.zhang@intel.com>
#
platform=$(uname)
if [ platform == "Linux" ];then
    if [[ -f "/etc/sudoers" && -f "/etc/login.defs" ]];then
        #get first user name 
        min_uid=$(cat /etc/login.defs|grep -v '#'|awk '/UID_MIN/ {print $2;}')
        cur_user=$(cat /etc/passwd|grep -v '#'|awk -F: -v userid="${min_uid:=500}"  '{ if ($3 == userid) print $1; }' /etc/passwd)
        if [ ${cur_user:="root"} != "root" ];then
            echo "Update sudoers configuration, it will take some mins"
            sed -i "/$cur_user/d" /etc/sudoers
            #append line into sudoers to configure switch to root without password
            sed -i "\$a$cur_user\tALL=(ALL)\tNOPASSWD: ALL" /etc/sudoers
        fi
    fi
fi
